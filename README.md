# 新能源发电功率预测系统

## 项目概述
本项目旨在预测次日零时起到未来24小时逐15分钟级新能源场站发电功率。系统可处理10个新能源场站（5个风电和5个光伏）的数据，并利用三种不同来源的气象数据进行预测。

## 数据结构
1. **功率数据**：包含10个新能源场站的归一化发电功率数据，CSV格式，15分钟间隔。
2. **气象数据**：来自三个不同来源（NWP_1, NWP_2, NWP_3）的NC格式数据，包含多个气象变量。

### 气象变量
- u100: 100米高度纬向风 (m/s)
- v100: 100米高度经向风 (m/s)
- t2m: 2米气温 (K)
- tp: 总降水量 (m)
- tcc: 总云量 (0-1)
- sp: 地面气压 (Pa)
- poai: 光伏面板辐照度 (W/m²)
- ghi: 水平面总辐照度 (W/m²)
- msl: 海平面气压 (Pa)

## 主要组件
1. `data_processor.py` - 负责数据读取、处理和特征工程
2. `power_prediction_model.py` - 负责模型训练和预测
3. `read_weather_data.py` - 用于读取和分析NC格式的气象数据

## 预测范围
- 场站：可处理全部10个场站（1-10）
- 时间范围：可处理从2024年1月1日到2024年12月30日的训练数据
- 预测范围：可预测从2025年1月1日到2025年2月28日的功率数据
- 气象源：可处理全部3个气象源（NWP_1, NWP_2, NWP_3）

## 输出格式
- 预测结果保存为CSV文件
- 文件命名格式为"outputX.csv"，其中X是场站ID
- 文件中的数据格式为：
  - 索引为北京时间的时间戳，格式为"YYYY/M/D HH:MM"
  - 列名为'power'
  - 每个文件包含96×D条数据（每天24小时，15分钟分辨率的功率预测，共D日）

## 使用方法

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行测试
在运行完整预测前，建议先运行测试以确保程序能正确处理数据：
```bash
python power_prediction_model.py --test
```
测试会验证以下几个方面：
1. 历史数据读取
2. 训练数据加载
3. 模型训练
4. 单日预测

### 运行预测
运行完整的预测流程（处理所有10个场站，从2025年1月1日到2025年2月28日）：
```bash
python power_prediction_model.py
```

### 自定义预测参数
您可以通过修改`power_prediction_model.py`中的`main`函数来调整预测参数：

```python
# 设置参数
station_ids = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  # 所有场站
start_date = '20240101'                        # 训练数据开始日期
end_date = '20241230'                          # 训练数据结束日期
model_type = 'xgboost'                         # 模型类型
prediction_start_date = '20250101'             # 预测开始日期
prediction_end_date = '20250228'               # 预测结束日期
nwp_sources = ['NWP_1', 'NWP_2', 'NWP_3']      # 气象源
```

### 结果文件
每次运行程序时，结果会保存在带时间戳的目录中，避免覆盖之前的结果：
- 模型文件：`models/YYYYMMDD_HHMMSS/station_X_xgboost_model.pkl`
- 预测结果：`results/YYYYMMDD_HHMMSS/outputX.csv`

### 默认值生成
当无法获取气象数据或模型预测失败时，程序会：
1. 首先尝试基于历史数据的统计特性生成默认值
2. 如果历史数据不可用，则使用基于时间的默认值

## 依赖项
请参考`requirements.txt`文件安装所需的依赖项。

## 性能说明
完整运行所有10个场站的预测（从2025年1月1日到2025年2月28日）预计需要40-90分钟，具体取决于计算机性能。
